<?xml version="1.0" encoding="UTF-8" ?>
<Module>
	<ModulePrefs title="gsites-proof-of-concept">
		<Require feature="idi"/>
		<Require feature="locked-domain" />
		<Require feature="dynamic-height"/>
		<Require feature="setprefs" />
	</ModulePrefs>

	<UserPref name="_table_query_url" default_value="" display_name="Data source url" required="true" />

	<Content type="html">
		<![CDATA[

			<script src="https://www.google.com/jsapi" type="text/javascript"></script>

			<div id="container"></div>

			<script type="text/javascript">

				var gadgetHelper = null;
				var prefs = new _IG_Prefs();
				var urlTable = prefs.getString(_table_query_url);

				_IG_RegisterOnloadHandler(loadVisualizationAPI);

				function loadVisualizationAPI() {
					google.load("visualization", "1", {"packages": ["table"]});
					google.setOnLoadCallback(sendQuery);
				}

				function sendQuery() {
					gadgetHelper = new google.visualization.GadgetHelper();
					var opts = {dataType:'jsonp'};
					var query = new google.visualization.Query(urlTable, opts);
					var querytosend = "select *";
					query.setQuery(querytosend);
					query.send(handleQueryResponse);
				}

				function handleQueryResponse(response) {
					data = response.getDataTable();
					var rows = data.getNumberOfRows();
					var content = "";

					if(rows>0) {
						content += '<ul>';
						for(i=0; i<rows; i++) {
							content += '<li>' + data.getValue(i,0) + '</li>';
						}
						content += '</ul>';
					}
					else {
						content += '<p>No se ha podido cargar datos :(</p>';
					}

					document.getElementById("container").innerHTML = content;
				}

			</script>

		]]>
	</Content>
</Module>
